{% embed '@SalesReturnGui/_partials/column.twig' with {
    title: 'Returned Items'
} %}
    {% block content %}
        <div class="row">
            <div class="col-lg-6">
                {{ 'Trigger all matching states' | trans }}
                <span class="js-item-counter-wrapper hidden">{{ 'of ' | trans }}
                    <span class="js-item-counter"></span>
                    {{ ' selected items' | trans }}
                </span>
            </div>
            <div class="header-actions js-return-bulk-trigger-buttons col-lg-6">
                {% include '@Oms/RenderForm/_partial/order-items-actions.twig' ignore missing with {
                    redirectUrl: triggerButtonRedirectUrl,
                    salesOrderItemIds: salesOrderItemIds,
                    events: uniqueOrderItemManualEvents,
                } only %}
            </div>
        </div>

        <hr>

        <div class="table-responsive">
            <table class="table js-return-items-table" data-qa="return-items-table">
                <thead>
                    <tr class="text-left">
                        <th><input type="checkbox" class="js-check-all-items"></th>
                        <th colspan="2">{{ 'Product' | trans }}</th>
                        <th>{{ 'Quantity' | trans }}</th>
                        <th>{{ 'Price' | trans }}</th>
                        <th>{{ 'Total' | trans }}</th>
                        <th>{{ 'State' | trans }}</th>
                        <th>{{ 'Trigger event' | trans }}</th>
                    </tr>
                </thead>

                <tbody>
                    {% set order = {
                        currencyIsoCode: (return.returnItems | first).orderItem.currencyIsoCode ?? null
                    } %}

                    {% set returnItemsWithConfiguredBundles = [] %}

                    {% for returnItem in return.returnItems %}
                        {% if returnItem.orderItem.salesOrderConfiguredBundle is empty %}
                            {% include '@SalesReturnGui/Return/_partials/return-detail-item.twig' with {
                                returnItem: returnItem,
                                orderItem: returnItem.orderItem,
                                order: order,
                                eventsGroupedByItem: orderItemManualEvents,
                                changeStatusRedirectUrl: triggerButtonRedirectUrl,
                            } only %}
                        {% else %}
                            {% set returnItemsWithConfiguredBundles = returnItemsWithConfiguredBundles | merge([returnItem]) %}
                        {% endif %}
                    {% endfor %}

                    {% include '@SalesReturnGui/Return/_partials/return-detail-configured-bundles.twig' with {
                        returnItems: returnItemsWithConfiguredBundles,
                        order: order,
                        orderItemManualEvents: orderItemManualEvents,
                        triggerButtonRedirectUrl: triggerButtonRedirectUrl,
                    } only %}
                </tbody>
            </table>
        </div>
    {% endblock %}
{% endembed %}
